/*!
 * 
 *       Copyright (c) 2019 Kenny Do
 *   
 *       THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 *       IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 *       FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 *       AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 *       LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 *       OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 *       SOFTWARE.
 *   
 *     
 */!function(e){function t(t){for(var r,s,i=t[0],u=t[1],l=t[2],d=0,p=[];d<i.length;d++)s=i[d],a[s]&&p.push(a[s][0]),a[s]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);for(c&&c(t);p.length;)p.shift()();return n.push.apply(n,l||[]),o()}function o(){for(var e,t=0;t<n.length;t++){for(var o=n[t],r=!0,i=1;i<o.length;i++){var u=o[i];0!==a[u]&&(r=!1)}r&&(n.splice(t--,1),e=s(s.s=o[0]))}return e}var r={},a={2:0},n=[];function s(t){if(r[t])return r[t].exports;var o=r[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,s),o.l=!0,o.exports}s.m=e,s.c=r,s.d=function(e,t,o){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(o,r,function(t){return e[t]}.bind(null,r));return o},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var i=window.webpackJsonp=window.webpackJsonp||[],u=i.push.bind(i);i.push=t,i=i.slice();for(var l=0;l<i.length;l++)t(i[l]);var c=u;n.push([29,0]),o()}([,,,,,,,,function(e,t){e.exports=ReduxWebExt},function(e,t,o){"use strict";var r,a,n,s=o(36),i="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";function u(){n=!1}function l(e){if(e){if(e!==r){if(e.length!==i.length)throw new Error("Custom alphabet for shortid must be "+i.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter(function(e,t,o){return t!==o.lastIndexOf(e)});if(t.length)throw new Error("Custom alphabet for shortid must be "+i.length+" unique characters. These characters were not unique: "+t.join(", "));r=e,u()}}else r!==i&&(r=i,u())}function c(){return n||(n=function(){r||l(i);for(var e,t=r.split(""),o=[],a=s.nextValue();t.length>0;)a=s.nextValue(),e=Math.floor(a*t.length),o.push(t.splice(e,1)[0]);return o.join("")}())}e.exports={get:function(){return r||i},characters:function(e){return l(e),r},seed:function(e){s.seed(e),a!==e&&(u(),a=e)},lookup:function(e){return c()[e]},shuffled:c}},,,,,function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{static init(e){r.store=e}}t.default=r},,,,,,function(e,t,o){"use strict";e.exports=o(35)},,,,,,,,,function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=o(2),a=o(5),n=r.__importDefault(o(31)),s=o(3),i=r.__importDefault(o(14)),u=r.__importDefault(o(43));let l,c,d=!1;const p=()=>{d||(d=!0,setTimeout(()=>(d=!1,browser.storage.local.set({state:JSON.stringify(l.getState())})),1e3))},f=()=>{const e=c;c=l.getState().settings,!e.contextualIdentities.value&&c.contextualIdentities.value&&l.dispatch(a.cacheCookieStoreIdNames()),!e.localstorageCleanup.value&&c.localstorageCleanup.value&&browser.browsingData.removeLocalStorage({since:0}),e.activeMode.value&&!c.activeMode.value&&browser.alarms.clear("activeModeAlarm")};(()=>r.__awaiter(this,void 0,void 0,function*(){browser.browserAction.setTitle({title:`${yield browser.browserAction.getTitle({})} ${browser.runtime.getManifest().version}`});const e=yield browser.storage.local.get();let t;try{t=e.state?JSON.parse(e.state):{}}catch(e){t={}}if((l=n.default(t)).dispatch({type:"ON_STARTUP"}),"Firefox"===browserDetect()){const e=(yield browser.runtime.getBrowserInfo()).version.split(".")[0];if(l.dispatch({payload:{key:"browserVersion",value:e},type:"ADD_CACHE"}),e>="58"){const e=yield browser.privacy.websites.firstPartyIsolate.get({});l.dispatch({payload:{key:"firstPartyIsolateSetting",value:e.value},type:"ADD_CACHE"})}}l.dispatch({payload:{key:"browserDetect",value:browserDetect()},type:"ADD_CACHE"});const o=yield browser.runtime.getPlatformInfo();l.dispatch({payload:{key:"platformOs",value:o.os},type:"ADD_CACHE"}),s.getSetting(l.getState(),"contextualIdentities")&&l.dispatch(a.cacheCookieStoreIdNames()),c=l.getState().settings,l.subscribe(f),l.subscribe(p),i.default.init(l),l.dispatch(a.validateSettings()),browser.tabs.onUpdated.addListener(u.default.onDomainChange),browser.tabs.onUpdated.addListener(u.default.onTabUpdate),browser.tabs.onRemoved.addListener(u.default.onDomainChangeRemove),browser.tabs.onRemoved.addListener(u.default.cleanFromFromTabEvents)}))(),browser.runtime.onStartup.addListener(()=>r.__awaiter(this,void 0,void 0,function*(){yield g(),E()})),browser.runtime.onInstalled.addListener(e=>r.__awaiter(this,void 0,void 0,function*(){yield g(),"update"===e.reason&&s.convertVersionToNumber(e.previousVersion)<300&&l.dispatch({type:"RESET_COOKIE_DELETED_COUNTER"})}));const g=()=>r.__awaiter(this,void 0,void 0,function*(){for(;!l;)yield s.sleep(250)}),E=()=>{s.getSetting(l.getState(),"activeMode")&&l.dispatch(a.cookieCleanup({greyCleanup:!0,ignoreOpenTabs:s.getSetting(l.getState(),"cleanCookiesFromOpenTabsOnStartup")}))}},,function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=o(2),a=o(11),n=r.__importDefault(o(33)),s=o(8),i=o(5),u=r.__importDefault(o(34)),l=e=>e=>t=>{let o;return o=e(t)},c={ADD_EXPRESSION:i.addExpression,COOKIE_CLEANUP:i.cookieCleanup,REMOVE_ACTIVITY_LOG:i.removeActivity,REMOVE_EXPRESSION:i.removeExpression,RESET_ALL:i.resetAll,RESET_COOKIE_DELETED_COUNTER:i.resetCookieDeletedCounter,RESET_SETTINGS:i.resetSettings,UPDATE_EXPRESSION:i.updateExpression,UPDATE_SETTING:i.updateSetting};t.default=((e={})=>s.createBackgroundStore({actions:c,store:a.createStore(u.default,e,a.applyMiddleware(n.default,l))}))},,function(e,t,o){"use strict";function r(e){return function(t){var o=t.dispatch,r=t.getState;return function(t){return function(a){return"function"==typeof a?a(o,r,e):t(a)}}}}o.r(t);var a=r();a.withExtraArgument=r,t.default=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=o(2),a=o(11),n=r.__importDefault(o(20)),s=o(19),i=(e,t)=>Object.assign({},t.payload,{cookieNames:t.payload.cookieNames?t.payload.cookieNames:[],id:n.default.generate(),listType:t.payload.listType?t.payload.listType:"WHITE"}),u=(e,t)=>"WHITE"===e.listType&&"GREY"===t.listType?-1:"WHITE"===t.listType&&"GREY"===e.listType?1:e.expression.localeCompare(t.expression);t.expression=((e={cookieNames:[],expression:"",id:"1",listType:"WHITE",storeId:"default"},t)=>{switch(t.type){case"UPDATE_EXPRESSION":return e.id===t.payload.id?i(0,t):e;default:return e}}),t.expressions=((e=[],o)=>{switch(o.type){case"ADD_EXPRESSION":return((e,t)=>e.some(e=>e.expression===t.payload.expression))(e,o)?e:[...e,i(0,o)].sort(u);case"UPDATE_EXPRESSION":return e.map(e=>t.expression(e,o)).sort(u);case"REMOVE_EXPRESSION":return e.filter(e=>e.id!==o.payload.id);case"RESET_ALL":return[];default:return e}}),t.lists=((e={},o)=>{switch(o.type){case"ADD_EXPRESSION":case"REMOVE_EXPRESSION":case"UPDATE_EXPRESSION":const r=Object.assign({},e);return r[o.payload.storeId]=t.expressions(e[o.payload.storeId],o),r;case"RESET_ALL":return{};default:return e}}),t.settings=((e=s.initialState.settings,t)=>{switch(t.type){case"UPDATE_SETTING":{const{name:o}=t.payload,r=Object.assign({},e);return r[o]=Object.assign({},t.payload,{id:n.default.generate()}),r}case"RESET_ALL":case"RESET_SETTINGS":return s.initialState.settings;default:return e}}),t.cookieDeletedCounterTotal=((e=0,t)=>{switch(t.type){case"INCREMENT_COOKIE_DELETED_COUNTER":return e+(void 0===t.payload?1:t.payload);case"RESET_ALL":case"RESET_COOKIE_DELETED_COUNTER":return 0;default:return e}}),t.cookieDeletedCounterSession=((e=0,t)=>{switch(t.type){case"INCREMENT_COOKIE_DELETED_COUNTER":return e+(void 0===t.payload?1:t.payload);case"RESET_ALL":case"ON_STARTUP":case"RESET_COOKIE_DELETED_COUNTER":return 0;default:return e}}),t.activityLog=((e=[],t)=>{switch(t.type){case"ADD_ACTIVITY_LOG":return Object.keys(t.payload.storeIds).length>0?[t.payload,...e].slice(0,10):e;case"REMOVE_ACTIVITY_LOG":return e.filter(e=>e.dateTime!==t.payload.dateTime);case"RESET_ALL":case"RESET_COOKIE_DELETED_COUNTER":return[];default:return e}}),t.cache=((e={},t)=>{switch(t.type){case"ADD_CACHE":{const o=Object.assign({},e);return o[`${t.payload.key}`]=t.payload.value,o}case"RESET_ALL":return{};default:return e}}),t.default=a.combineReducers({activityLog:t.activityLog,cache:t.cache,cookieDeletedCounterSession:t.cookieDeletedCounterSession,cookieDeletedCounterTotal:t.cookieDeletedCounterTotal,lists:t.lists,settings:t.settings})},function(e,t,o){"use strict";var r=o(9),a=o(37),n=o(41),s=o(42)||0;function i(){return a(s)}e.exports=i,e.exports.generate=i,e.exports.seed=function(t){return r.seed(t),e.exports},e.exports.worker=function(t){return s=t,e.exports},e.exports.characters=function(e){return void 0!==e&&r.characters(e),r.shuffled()},e.exports.isValid=n},function(e,t,o){"use strict";var r=1;e.exports={nextValue:function(){return(r=(9301*r+49297)%233280)/233280},seed:function(e){r=e}}},function(e,t,o){"use strict";var r,a,n=o(38),s=(o(9),1459707606518),i=6;e.exports=function(e){var t="",o=Math.floor(.001*(Date.now()-s));return o===a?r++:(r=0,a=o),t+=n(i),t+=n(e),r>0&&(t+=n(r)),t+=n(o)}},function(e,t,o){"use strict";var r=o(9),a=o(39),n=o(40);e.exports=function(e){for(var t,o=0,s="";!t;)s+=n(a,r.get(),1),t=e<Math.pow(16,o+1),o++;return s}},function(e,t,o){"use strict";var r,a="object"==typeof window&&(window.crypto||window.msCrypto);r=a&&a.getRandomValues?function(e){return a.getRandomValues(new Uint8Array(e))}:function(e){for(var t=[],o=0;o<e;o++)t.push(Math.floor(256*Math.random()));return t},e.exports=r},function(e,t){e.exports=function(e,t,o){for(var r=(2<<Math.log(t.length-1)/Math.LN2)-1,a=Math.ceil(1.6*r*o/t.length),n="";;)for(var s=e(a),i=0;i<a;i++){var u=s[i]&r;if(t[u]&&(n+=t[u]).length===o)return n}}},function(e,t,o){"use strict";var r=o(9);e.exports=function(e){return!(!e||"string"!=typeof e||e.length<6||new RegExp("[^"+r.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]").test(e))}},function(e,t,o){"use strict";e.exports=0},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=o(2),a=r.__importDefault(o(20)),n=r.__importDefault(o(44)),s=o(18),i=o(3),u=r.__importDefault(o(14));class l extends u.default{static onTabUpdate(e,t,o){"complete"===o.status&&(s.checkIfProtected(l.store.getState(),o),l.onTabUpdateDelay||(l.onTabUpdateDelay=!0,setTimeout(()=>{l.getAllCookieActions(o),l.onTabUpdateDelay=!1},750)))}static onDomainChange(e,t,o){if("complete"===o.status){const t=i.extractMainDomain(i.getHostname(o.url));void 0===l.tabToDomain[e]&&""!==t?l.tabToDomain[e]=t:l.tabToDomain[e]!==t&&""!==t&&(l.tabToDomain[e]=t,i.getSetting(u.default.store.getState(),"domainChangeCleanup")&&l.cleanFromFromTabEvents())}}static onDomainChangeRemove(e){delete l.tabToDomain[e]}static getAllCookieActions(e){return r.__awaiter(this,void 0,void 0,function*(){const t=i.getHostname(e.url),o=yield browser.cookies.getAll(i.returnOptionalCookieAPIAttributes(u.default.store.getState(),{domain:t,firstPartyDomain:i.extractMainDomain(t),storeId:e.cookieStoreId}));let r=o.length;if(0===o.length&&i.getSetting(n.default.store.getState(),"localstorageCleanup")&&i.isAWebpage(e.url)){const t=i.returnOptionalCookieAPIAttributes(u.default.store.getState(),{expirationDate:Math.floor(Date.now()/1e3+31557600),firstPartyDomain:i.extractMainDomain(i.getHostname(e.url)),name:"CookieAutoDelete",path:`/${a.default.generate()}`,storeId:e.cookieStoreId,value:"cookieForLocalstorageCleanup"});browser.cookies.set(Object.assign({},t,{url:e.url||""})),r=1}i.getSetting(u.default.store.getState(),"showNumOfCookiesInIcon")?s.showNumberOfCookiesInIcon(e,r):browser.browserAction.setBadgeText({tabId:e.id,text:""})})}}l.cleanFromFromTabEvents=(()=>r.__awaiter(this,void 0,void 0,function*(){if(i.getSetting(u.default.store.getState(),"activeMode")){const e=yield browser.alarms.get("activeModeAlarm");"Firefox"!==u.default.store.getState().cache.browserDetect||e?e&&"activeModeAlarm"!==e.name&&n.default.createActiveModeAlarm():n.default.createActiveModeAlarm()}})),l.onTabUpdateDelay=!1,l.tabToDomain={},t.default=l},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=o(2),a=o(5),n=o(3),s=r.__importDefault(o(14));class i extends s.default{static createActiveModeAlarm(){return r.__awaiter(this,void 0,void 0,function*(){const e=parseInt(n.getSetting(this.store.getState(),"delayBeforeClean"),10),t=1e3*e;this.alarmFlag||(this.alarmFlag=!0,e<1?(yield n.sleep(500),this.store.dispatch(a.cookieCleanup({greyCleanup:!1,ignoreOpenTabs:!1})),this.alarmFlag=!1):(yield n.sleep(t),n.getSetting(this.store.getState(),"activeMode")&&this.store.dispatch(a.cookieCleanup({greyCleanup:!1,ignoreOpenTabs:!1})),this.alarmFlag=!1))})}}i.alarmFlag=!1,t.default=i}]);